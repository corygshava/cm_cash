<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="css/common.css">
	<link rel="stylesheet" href="css/styles.css">
	<link rel="stylesheet" href="css/w3.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">

	<title>GashMan - home</title>

	<style>
		.content{
			padding: 10px 20px;
		}
		.sums{
			display: flex;
			flex-direction: row;
			flex-wrap: wrap;
			gap: 20px;
			margin: 20px 0;
		}
		.sums .sum{
			flex: 1 0 250px;
			border-radius: var(--roundness);
			border: 1px solid var(--containerbg);
			padding: 20px 7px;
		}
		.sum.bal{
			color: var(--alttextcolor) !important;
		}
		.sum.bal.good{background-image: linear-gradient(-80deg,var(--themecolor),var(--incolor));}
		.sum.bal.bad{background-image: linear-gradient(-80deg,var(--themecolor),var(--outcolor));}
		.sum .bal .number{
			font-weight: 900;
		}
		.sum span{
			display: block;
			padding: 3px 20px;
		}
		.sum .caption{
			color: var(--textcolor);
			letter-spacing: 2px;
			opacity: 0.7;
			text-transform: uppercase;
		}
		.sum .number{
			font-size: 25px;
			font-weight: 700;
		}
		.sum .desc{
			font-size: 14px;
		}

		.thedatas{
			display: flex;
			flex-direction: row;
			flex-wrap: wrap;
			gap: 20px;
		}
		.datapanel{
			flex: 1 0 300px;
			min-height: 300px;
			border: 1px solid var(--containerbg);
			padding: 20px;
			border-radius: var(--roundness);
		}

		.options{
			text-align: center;
			border-top: 2px solid var(--containerbg);
			padding: 20px 12px;
		}
	</style>
</head>
<body data-mode="dark">
	<header class="profile_top">
		<img src="images/profile.png" alt="your profile picture" class="pic">
		<div class="nem">
			<span>Good afternoon</span><br>
			<b class="hed">John</b>
		</div>
	</header>

	<nav>
		<a href="index.html" class="navlink active"><i class="fa fa-dashboard"></i> summary</a>
		<a href="trx.html" class="navlink"><i class="fa fa-exchange"></i> transactions</a>
		<a href="new_trx.html" class="navlink"><i class="fa fa-plus"></i> add</a>
		<a href="settings.html" class="navlink"><i class="fa fa-cog"></i> settings</a>
	</nav>

	<div class="content">
		<div class="sums">
			<div class="sum bal good">
				<span class="caption">balance</span>
				<span class="number currency" id="amt_balance">--</span>
				<span class="desc">available cash</span>
			</div>
			<div class="sum">
				<span class="caption">Today's budget</span>
				<span class="number currency themetxt" id="amt_budget">--</span>
				<span class="desc">you can spend</span>
			</div>
			<div class="sum">
				<span class="caption">Today's expenses</span>
				<span class="number currency out_txt" id="amt_expense">--</span>
				<span class="desc">you have spent</span>
			</div>
			<div class="sum">
				<span class="caption">Today's income</span>
				<span class="number currency in_txt" id="amt_earn">--</span>
				<span class="desc">you've earned</span>
			</div>
		</div>

		<div class="thedatas">
			<div class="datapanel udata">
				<h2>Recent transactions</h2>
				<hr>
				<div class="transtable">
					<div class="nada">---</div>
				</div>
				<div class="options w3-center">
					<a href="new_trx.html" class="themebtn"><i class="fa fa-plus"></i> add new</a>
					<a href="trx.html" class="themebtn"><i class="fa fa-list"></i> list all</a>
				</div>
			</div>

			<div class="datapanel ugraph">
				<h2>Expenditure VS income graph</h2>
				<hr>
				<div class="chart">
					<div class="nada">
						<i>coming soon</i>
					</div>
				</div>

				<div class="options">
					<button class="themebtn">reset data</button>
				</div>
			</div>
		</div>

		<div class="dailydata">
			<div class="section">
				<h3>daily expenditure limits</h3>
				<hr>
				<div class="daysguy">
					<div class="daybox">
						<b>Sun</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Mon</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Tues</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Wed</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Thurs</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Fri</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Sat</b>
						<span class="thenum">200</span>
					</div>
				</div>
			</div>
		</div>

		<div class="earndata">
			<div class="section">
				<h3>weekly earnings</h3>
				<hr>
				<div class="daysguy">
					<div class="daybox">
						<b>Sun</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Mon</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Tues</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Wed</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Thurs</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Fri</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Sat</b>
						<span class="thenum">200</span>
					</div>
				</div>
			</div>
		</div>

		<div class="spenddata">
			<div class="section">
				<h3>weekly expenditure</h3>
				<hr>
				<div class="daysguy">
					<div class="daybox">
						<b>Sun</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Mon</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Tues</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Wed</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Thurs</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Fri</b>
						<span class="thenum">200</span>
					</div>
					<div class="daybox">
						<b>Sat</b>
						<span class="thenum">200</span>
					</div>
				</div>
			</div>
		</div>

		<div class="weekdata">
			<div class="section">
				<h3>weekly data</h3>
				<hr>
				<div class="daysguy">
				</div>
			</div>
		</div>
	</div>

	<footer>
		&copy; CoryG
	</footer>

	<script src="js/SuperScript.js"></script>
	<script src="js/toappend.js"></script>
	<script src="js/app.js"></script>
	<script src="js/trx_ops.js"></script>

	<script>
		// your summary
		let balance = document.querySelector('#amt_balance');
		let day_budget = document.querySelector('#amt_budget');
		let day_expense = document.querySelector('#amt_expense');
		let day_earn = document.querySelector('#amt_earn');

		// recent transactions
		let recentia = document.querySelector('.transtable');

		// dailys
		let dailys_Holder = document.querySelector('.dailydata');
		let spends_Holder = document.querySelector('.spenddata');
		let earn_Holder = document.querySelector('.earndata');
		let dailys = dailys_Holder.querySelectorAll('.daybox');

		let thadate = new Date();
		// date format = 'm/d/y';
		let datedata = reformatDate(thadate);

		let weeklyReport = {};

		function init() {
			weeklyReport = getWeeklyCashReport();
		}

		function mekUI() {
			// top summary
			showtrx(recentia,7,"no recent transactions",true);

			let d_balance = getbalance();
			let d_expense = getexpense(datedata);
			let d_earnings = getearnings(datedata);
			let d_dayly = getdayly(thadate);

			balance.innerHTML = d_balance.toLocaleString();
			day_expense.innerHTML = `${d_expense.toLocaleString()} <b class="w3-text-grey smaller">/ ${d_dayly.toLocaleString()}</b>`;
			day_earn.innerHTML = d_earnings.toLocaleString();
			day_budget.innerHTML = `${d_dayly.toLocaleString()}`;

			let theclass = (d_expense > d_dayly) ? "out_txt" : "in_txt";
			day_expense.className = `number currency ${theclass}`;

			// daily limits (replace with tha showdailys code later)
		}

		// this code section is for testing purposes only, move above once its approved
		function showdailys() {
			dailys.forEach((el,id) => {
				let numtxt = el.querySelectorAll('.thenum');

				el.dataset.myid = id;
				numtxt[0].innerHTML = weeklimits[id];

				if(id == thadate.getDay())
					el.classList.add("current");
			});
		}

		function showWeekData() {
			let holder = document.querySelector('.weekdata');
			let datadis = holder.querySelector(".daysguy");
			let dta = weeklyReport;
			let weekdata = [getsum(dta.w_expenses),getsum(dta.w_income),dta.w_maxspend,dta.w_maxearn,dta.w_minspend,dta.w_minearn,getsum(weeklimits)];
			let weekcaptions = ["week's <br>expenses","week's <br>income","max daily <br>expenditure","max daily<br> earnings","min daily <br>expenditure","min daily<br> earnings","week's <br>budget"]

			weekdata.forEach((el,id) => {
				let addclass = (weekcaptions[id].includes("budget")) ? "special" : "";
				datadis.innerHTML += `
					<div class="daybox ${addclass}">
						<b>${weekcaptions[id]}</b>
						<span class="currency thenum w3-tag w3-black">${weekdata[id].toLocaleString()}</span>
					</div>
				`;
			})
		}

		function showspendsData() {
			let outs = spends_Holder.querySelectorAll('.daybox');
			let allspend = 0;
			let cur_limit = 0;

			outs.forEach((el,id) => {
				let thenum = el.querySelector('.thenum');
				let num = weeklyReport.w_expenses[id];
				let diff = "--",verdict = "",xtra = "",exd = "";
				let surp = 0;

				if(num > weeklimits[id])
					thenum.classList.add('out_txt');

				let thadate = new Date(weeklyReport.w_dates[id]);
				diff = weeklimits[id] - num;
				allspend += num;
				cur_limit += weeklimits[id];

				if(thadate < today){
					verdict = diff > 0 ? "in_txt" : "out_txt";
					xtra = diff > 0 ? "/= spared" : "/= extra";

					if(thadate.toLocaleDateString() == today.toLocaleDateString()){
						surp = cur_limit - allspend;
						xtra = diff > 0 ? "/= remaining" : "/= over budget";
						exd = `<span style="font-size: 12px;">${surp}/= surplus</span>`;
					}
				}

				thenum.innerHTML = `${(num).toLocaleString()}`;

				el.innerHTML += `<br><span class="${verdict}"style="font-size: 12px;">${Math.abs(diff)}${xtra}</span><br>${exd}`;
			})
		}

		function showearnData() {
			let outs = earn_Holder.querySelectorAll('.daybox');

			outs.forEach((el,id) => {
				let thenum = el.querySelector('.thenum');
				let num = weeklyReport.w_income[id];

				if(num > 0)
					thenum.classList.add('in_txt');

				thenum.innerHTML = `${(num).toLocaleString()}`;
			})
		}

		console.log(weeklimits);
	</script>

	<script>
		// initialisers
		init();

		getWeekLimits();
		showdailys();
		showspendsData();
		showearnData();
		showWeekData();

		mekUI(); // MUST RUN LAST!!!
	</script>
</body>
</html>